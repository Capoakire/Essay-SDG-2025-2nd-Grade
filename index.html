<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Essay Writing Tool: Career & SDG</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            color: #2d3748;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        h1 {
            margin: 0 0 10px 0;
            font-size: 2.5em;
            font-weight: 700;
        }
        
        .subtitle {
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .content {
            padding: 30px;
        }
        
        h2 {
            color: #4f46e5;
            font-size: 1.6em;
            margin: 30px 0 20px 0;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }
        
        .section {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .section:hover {
            border-color: #4f46e5;
            box-shadow: 0 5px 15px rgba(79, 70, 229, 0.1);
        }
        
        label {
            font-weight: 600;
            color: #374151;
            display: block;
            margin-bottom: 12px;
            font-size: 1.1em;
        }
        
        textarea {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            resize: vertical;
            font-size: 1em;
            font-family: inherit;
            background: white;
            transition: all 0.3s ease;
            line-height: 1.6;
        }
        
        textarea:focus {
            border-color: #4f46e5;
            outline: none;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        .textarea-wrapper {
            position: relative;
        }
        
        .word-counter {
            position: absolute;
            bottom: 10px;
            right: 15px;
            background: rgba(79, 70, 229, 0.9);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 500;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        button {
            padding: 10px 20px;
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 70, 229, 0.3);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button.secondary {
            background: linear-gradient(135deg, #6b7280, #9ca3af);
        }
        
        .suggestions {
            margin-top: 15px;
            padding: 15px;
            background: linear-gradient(135deg, #ddd6fe, #e0e7ff);
            border-radius: 12px;
            display: none;
            border-left: 4px solid #4f46e5;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .grammar-results {
            margin-top: 20px;
            padding: 20px;
            background: #fef2f2;
            border: 2px solid #fecaca;
            border-radius: 12px;
            display: none;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .grammar-results.success {
            background: #f0fdf4;
            border-color: #bbf7d0;
        }
        
        .grammar-issue {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #ef4444;
        }
        
        .grammar-issue.suggestion {
            border-left-color: #f59e0b;
        }
        
        .grammar-issue.success {
            border-left-color: #10b981;
        }
        
        #essay-preview {
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            border-radius: 15px;
            white-space: pre-wrap;
            line-height: 1.8;
            font-size: 1.05em;
            border: 2px solid #e5e7eb;
            display: none;
        }
        
        .action-buttons {
            text-align: center;
            margin: 30px 0;
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .loading {
            position: relative;
        }
        
        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        .progress-bar {
            height: 4px;
            background: #e5e7eb;
            border-radius: 2px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4f46e5, #7c3aed);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 2px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 12px;
            border: 2px solid #e5e7eb;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: 700;
            color: #4f46e5;
        }
        
        .stat-label {
            font-size: 0.9em;
            color: #6b7280;
            margin-top: 5px;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .content {
                padding: 20px;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            button {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìù Enhanced Essay Tool</h1>
            <div class="subtitle">Career & SDG Essay Builder with Advanced Grammar Checking</div>
        </div>
        
        <div class="content">
            <div class="stats" id="essay-stats">
                <div class="stat-card">
                    <div class="stat-number" id="total-words">0</div>
                    <div class="stat-label">Total Words</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="completion-rate">0%</div>
                    <div class="stat-label">Completion</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="grammar-score">-</div>
                    <div class="stat-label">Grammar Score</div>
                </div>
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>

            <h2>üìñ Introduction (75-100 words)</h2>
            <div class="section">
                <label>Hook with Fact + Job/Major & Why You Like It</label>
                <div class="textarea-wrapper">
                    <textarea id="intro-part1" oninput="updateCounters()" placeholder="Start with a compelling fact: 'Did you know that 70% of...' Then introduce your dream job/major and explain what draws you to it."></textarea>
                    <div class="word-counter" id="intro-part1-counter">0 words</div>
                </div>
                <div class="button-group">
                    <button onclick="showSuggestions('intro-part1')">üí° Show Tips</button>
                    <button class="secondary" onclick="checkSectionGrammar('intro-part1')">‚úÖ Quick Check</button>
                </div>
                <div class="suggestions" id="intro-part1-suggestions">
                    <strong>Pro Tips:</strong><br>
                    ‚Ä¢ Start with a surprising statistic or fact<br>
                    ‚Ä¢ Make it personal - why does this job excite YOU?<br>
                    ‚Ä¢ Use active voice: "I am passionate about..." not "It is interesting that..."<br>
                    ‚Ä¢ Connect the fact to your career choice logically
                </div>
            </div>

            <div class="section">
                <label>Related SDG Goal</label>
                <div class="textarea-wrapper">
                    <textarea id="intro-part2" oninput="updateCounters()" placeholder="Example: 'This career directly supports SDG 3: Good Health and Well-Being by addressing healthcare accessibility challenges in underserved communities.'"></textarea>
                    <div class="word-counter" id="intro-part2-counter">0 words</div>
                </div>
                <div class="button-group">
                    <button onclick="showSuggestions('intro-part2')">üí° Show Tips</button>
                    <button class="secondary" onclick="checkSectionGrammar('intro-part2')">‚úÖ Quick Check</button>
                </div>
                <div class="suggestions" id="intro-part2-suggestions">
                    <strong>SDG Connection Tips:</strong><br>
                    ‚Ä¢ Name the specific SDG number and title<br>
                    ‚Ä¢ Explain the direct connection, not just a loose relationship<br>
                    ‚Ä¢ Use specific language: "addresses," "tackles," "contributes to"<br>
                    ‚Ä¢ Be concise but clear about the relationship
                </div>
            </div>

            <div class="section">
                <label>Problem You Care About</label>
                <div class="textarea-wrapper">
                    <textarea id="intro-part3" oninput="updateCounters()" placeholder="Example: 'The critical issue I want to address is the growing mental health crisis among young adults, which directly relates to the alarming statistics I mentioned earlier.'"></textarea>
                    <div class="word-counter" id="intro-part3-counter">0 words</div>
                </div>
                <div class="button-group">
                    <button onclick="showSuggestions('intro-part3')">üí° Show Tips</button>
                    <button class="secondary" onclick="checkSectionGrammar('intro-part3')">‚úÖ Quick Check</button>
                </div>
                <div class="suggestions" id="intro-part3-suggestions">
                    <strong>Problem Focus Tips:</strong><br>
                    ‚Ä¢ Link back to your opening fact<br>
                    ‚Ä¢ Show emotional investment - why does this matter to YOU?<br>
                    ‚Ä¢ Be specific about the problem, not vague<br>
                    ‚Ä¢ Set up the significance for your next section
                </div>
            </div>

            <div class="section">
                <label>Why This Job & SDG Matter</label>
                <div class="textarea-wrapper">
                    <textarea id="intro-part4" oninput="updateCounters()" placeholder="Example: 'This career path and SDG are crucial to me because I witnessed firsthand how lack of mental health resources affected my community, driving my commitment to creating systemic change.'"></textarea>
                    <div class="word-counter" id="intro-part4-counter">0 words</div>
                </div>
                <div class="button-group">
                    <button onclick="showSuggestions('intro-part4')">üí° Show Tips</button>
                    <button class="secondary" onclick="checkSectionGrammar('intro-part4')">‚úÖ Quick Check</button>
                </div>
                <div class="suggestions" id="intro-part4-suggestions">
                    <strong>Personal Connection Tips:</strong><br>
                    ‚Ä¢ Share a personal story or observation<br>
                    ‚Ä¢ Show genuine passion and commitment<br>
                    ‚Ä¢ End with a strong transitional statement<br>
                    ‚Ä¢ Connect your values to the broader impact
                </div>
            </div>

            <h2>üìä Main Body (150-300 words)</h2>
            <div class="section">
                <label>Current Solutions/Progress for SDG</label>
                <div class="textarea-wrapper">
                    <textarea id="body-part1" oninput="updateCounters()" placeholder="Example: 'Current efforts toward achieving SDG 3 include WHO initiatives that have reduced child mortality by 50% since 1990. However, mental health resources remain critically underfunded, with only 2% of health budgets allocated to mental health globally.'"></textarea>
                    <div class="word-counter" id="body-part1-counter">0 words</div>
                </div>
                <div class="button-group">
                    <button onclick="showSuggestions('body-part1')">üí° Show Tips</button>
                    <button class="secondary" onclick="checkSectionGrammar('body-part1')">‚úÖ Quick Check</button>
                </div>
                <div class="suggestions" id="body-part1-suggestions">
                    <strong>Research & Analysis Tips:</strong><br>
                    ‚Ä¢ Use specific data and statistics<br>
                    ‚Ä¢ Acknowledge both successes and gaps<br>
                    ‚Ä¢ Reference credible sources (WHO, UN, etc.)<br>
                    ‚Ä¢ Balance optimism with realistic assessment
                </div>
            </div>

            <div class="section">
                <label>How Your Career Addresses These Issues</label>
                <div class="textarea-wrapper">
                    <textarea id="body-part2" oninput="updateCounters()" placeholder="Example: 'As a clinical psychologist, I would contribute by developing community-based therapy programs that are culturally sensitive and accessible. My role would involve training local healthcare workers and establishing sustainable mental health frameworks in underserved areas.'"></textarea>
                    <div class="word-counter" id="body-part2-counter">0 words</div>
                </div>
                <div class="button-group">
                    <button onclick="showSuggestions('body-part2')">üí° Show Tips</button>
                    <button class="secondary" onclick="checkSectionGrammar('body-part2')">‚úÖ Quick Check</button>
                </div>
                <div class="suggestions" id="body-part2-suggestions">
                    <strong>Career Impact Tips:</strong><br>
                    ‚Ä¢ Be specific about your role and actions<br>
                    ‚Ä¢ Show understanding of practical challenges<br>
                    ‚Ä¢ Demonstrate knowledge of your field<br>
                    ‚Ä¢ Connect daily work to larger SDG goals
                </div>
            </div>

            <div class="section">
                <label>Critical Reflection & Unique Insights</label>
                <div class="textarea-wrapper">
                    <textarea id="body-part3" oninput="updateCounters()" placeholder="Example: 'Reflecting on these challenges, I believe the most significant barrier is not just funding, but the stigma surrounding mental health in many cultures. My unique contribution would be integrating traditional healing practices with evidence-based therapy, creating bridges between communities and modern healthcare.'"></textarea>
                    <div class="word-counter" id="body-part3-counter">0 words</div>
                </div>
                <div class="button-group">
                    <button onclick="showSuggestions('body-part3')">üí° Show Tips</button>
                    <button class="secondary" onclick="checkSectionGrammar('body-part3')">‚úÖ Quick Check</button>
                </div>
                <div class="suggestions" id="body-part3-suggestions">
                    <strong>Critical Thinking Tips:</strong><br>
                    ‚Ä¢ Identify overlooked aspects of the problem<br>
                    ‚Ä¢ Propose innovative solutions or approaches<br>
                    ‚Ä¢ Show deeper understanding beyond surface issues<br>
                    ‚Ä¢ Connect different perspectives or disciplines
                </div>
            </div>

            <h2>üéØ Conclusion (75-100 words)</h2>
            <div class="section">
                <label>Summary & Future Vision</label>
                <div class="textarea-wrapper">
                    <textarea id="conclusion" oninput="updateCounters()" placeholder="Example: 'In conclusion, addressing the mental health crisis requires both systemic change and cultural sensitivity. Through my career in clinical psychology, I will contribute to SDG 3 by creating accessible, culturally-adapted mental health programs. I envision a future where mental healthcare is as prioritized as physical health. The path forward requires us all to challenge stigma, advocate for funding, and build bridges between communities and care.'"></textarea>
                    <div class="word-counter" id="conclusion-counter">0 words</div>
                </div>
                <div class="button-group">
                    <button onclick="showSuggestions('conclusion')">üí° Show Tips</button>
                    <button class="secondary" onclick="checkSectionGrammar('conclusion')">‚úÖ Quick Check</button>
                </div>
                <div class="suggestions" id="conclusion-suggestions">
                    <strong>Strong Conclusion Tips:</strong><br>
                    ‚Ä¢ Summarize key points without repeating exactly<br>
                    ‚Ä¢ Paint a vision of positive change<br>
                    ‚Ä¢ End with a call to action or inspiring statement<br>
                    ‚Ä¢ Connect back to your opening hook if possible
                </div>
            </div>

            <div class="action-buttons">
                <button onclick="generateEssay()">üìÑ Generate Full Essay</button>
                <button onclick="comprehensiveGrammarCheck()" id="grammar-btn">üîç Comprehensive Grammar Check</button>
                <button class="secondary" onclick="exportEssay()">üíæ Export Essay</button>
            </div>

            <div id="grammar-results" class="grammar-results"></div>
            <div id="essay-preview"></div>
        </div>
    </div>

    <script>
        // Enhanced grammar rules and common mistakes
        const grammarRules = {
            // Basic punctuation and capitalization
            capitalization: /^[a-z]/,
            endPunctuation: /[.!?]$/,
            
            // Common mistakes
            commonMistakes: [
                { pattern: /\b(there|their|they're)\b/gi, type: 'there/their/they\'re confusion' },
                { pattern: /\b(your|you're)\b/gi, type: 'your/you\'re confusion' },
                { pattern: /\b(its|it's)\b/gi, type: 'its/it\'s confusion' },
                { pattern: /\b(then|than)\b/gi, type: 'then/than usage' },
                { pattern: /\b(affect|effect)\b/gi, type: 'affect/effect confusion' },
                { pattern: /\b(loose|lose)\b/gi, type: 'loose/lose confusion' }
            ],
            
            // Style issues
            passiveVoice: /\b(was|were|is|are|am|be|being|been)\s+\w+ed\b/g,
            redundantPhrases: [
                'in order to', 'due to the fact that', 'at this point in time',
                'it is important to note that', 'the reason why is because'
            ],
            
            // Academic writing issues
            contractions: /\b(can't|won't|don't|isn't|aren't|hasn't|haven't|shouldn't|wouldn't|couldn't)\b/gi,
            informalWords: /\b(really|very|pretty|quite|sort of|kind of|a lot|lots of)\b/gi,
            firstPerson: /\b(I think|I believe|I feel|In my opinion)\b/gi
        };
        
        // Word frequency analysis for repetition detection
        function analyzeWordFrequency(text) {
            const words = text.toLowerCase().match(/\b\w{4,}\b/g) || [];
            const frequency = {};
            words.forEach(word => {
                frequency[word] = (frequency[word] || 0) + 1;
            });
            return Object.entries(frequency).filter(([word, count]) => count > 2);
        }
        
        // Readability analysis
        function analyzeReadability(text) {
            const sentences = text.split(/[.!?]+/).filter(s => s.trim());
            const words = text.split(/\s+/).filter(w => w.trim());
            const avgWordsPerSentence = words.length / sentences.length || 0;
            
            let complexSentences = 0;
            sentences.forEach(sentence => {
                const wordCount = sentence.split(/\s+/).length;
                if (wordCount > 25) complexSentences++;
            });
            
            return {
                avgWordsPerSentence,
                complexSentences,
                totalSentences: sentences.length,
                readabilityScore: avgWordsPerSentence < 20 ? 'Good' : avgWordsPerSentence < 25 ? 'Fair' : 'Complex'
            };
        }
        
        // Enhanced grammar checking function
        function performGrammarCheck(text, sectionName) {
            const issues = [];
            
            if (!text.trim()) return issues;
            
            // Basic checks
            if (!grammarRules.capitalization.test(text.trim())) {
                issues.push({
                    type: 'capitalization',
                    message: `${sectionName}: Start with a capital letter`,
                    severity: 'error'
                });
            }
            
            if (!grammarRules.endPunctuation.test(text.trim())) {
                issues.push({
                    type: 'punctuation',
                    message: `${sectionName}: End with proper punctuation (. ! ?)`,
                    severity: 'error'
                });
            }
            
            // Sentence length analysis
            const sentences = text.split(/[.!?]+/).filter(s => s.trim());
            sentences.forEach((sentence, i) => {
                const words = sentence.trim().split(/\s+/);
                if (words.length > 30) {
                    issues.push({
                        type: 'sentence-length',
                        message: `${sectionName}: Sentence ${i + 1} is too long (${words.length} words). Consider breaking it up.`,
                        severity: 'warning'
                    });
                } else if (words.length < 5 && sentence.trim()) {
                    issues.push({
                        type: 'sentence-length',
                        message: `${sectionName}: Sentence ${i + 1} might be too short. Consider adding more detail.`,
                        severity: 'suggestion'
                    });
                }
            });
            
            // Word repetition
            const repeatedWords = analyzeWordFrequency(text);
            repeatedWords.forEach(([word, count]) => {
                issues.push({
                    type: 'repetition',
                    message: `${sectionName}: Word "${word}" is repeated ${count} times. Consider using synonyms.`,
                    severity: 'suggestion'
                });
            });
            
            // Style issues
            const contractionMatches = text.match(grammarRules.contractions);
            if (contractionMatches) {
                issues.push({
                    type: 'style',
                    message: `${sectionName}: Avoid contractions in formal writing: ${contractionMatches.join(', ')}`,
                    severity: 'warning'
                });
            }
            
            const informalMatches = text.match(grammarRules.informalWords);
            if (informalMatches) {
                issues.push({
                    type: 'style',
                    message: `${sectionName}: Consider replacing informal words: ${[...new Set(informalMatches)].join(', ')}`,
                    severity: 'suggestion'
                });
            }
            
            // Passive voice detection
            const passiveMatches = text.match(grammarRules.passiveVoice);
            if (passiveMatches && passiveMatches.length > 2) {
                issues.push({
                    type: 'voice',
                    message: `${sectionName}: Consider using more active voice. Found ${passiveMatches.length} potential passive constructions.`,
                    severity: 'suggestion'
                });
            }
            
            return issues;
        }
        
        // Update word counters and statistics
        function updateCounters() {
            const sections = [
                'intro-part1', 'intro-part2', 'intro-part3', 'intro-part4',
                'body-part1', 'body-part2', 'body-part3', 'conclusion'
            ];
            
            let totalWords = 0;
            let filledSections = 0;
            
            sections.forEach(sectionId => {
                const textarea = document.getElementById(sectionId);
                const counter = document.getElementById(`${sectionId}-counter`);
                const text = textarea.value.trim();
                const words = text ? text.split(/\s+/).length : 0;
                
                counter.textContent = `${words} words`;
                totalWords += words;
                
                if (words > 0) filledSections++;
            });
            
            // Update statistics
            document.getElementById('total-words').textContent = totalWords;
            const completionRate = Math.round((filledSections / sections.length) * 100);
            document.getElementById('completion-rate').textContent = `${completionRate}%`;
            
            // Update progress bar
            document.getElementById('progress-fill').style.width = `${completionRate}%`;
        }
        
        function showSuggestions(sectionId) {
            const suggestions = document.getElementById(`${sectionId}-suggestions`);
            const isVisible = suggestions.style.display === 'block';
            suggestions.style.display = isVisible ? 'none' : 'block';
        }
        
        function checkSectionGrammar(sectionId) {
            const textarea = document.getElementById(sectionId);
            const text = textarea.value.trim();
            const sectionName = textarea.previousElementSibling.textContent;
            
            if (!text) {
                alert('Please write something in this section first!');
                return;
            }
            
            const issues = performGrammarCheck(text, sectionName);
            displayGrammarResults(issues, sectionName);
        }
        
        async function comprehensiveGrammarCheck() {
            const button = document.getElementById('grammar-btn');
            const originalText = button.textContent;
            button.textContent = 'Checking...';
            button.classList.add('loading');
            button.disabled = true;
            
            const sections = [
                { id: 'intro-part1', name: 'Introduction - Hook & Job' },
                { id: 'intro-part2', name: 'Introduction - SDG' },
                { id: 'intro-part3', name: 'Introduction - Problem' },
                { id: 'intro-part4', name: 'Introduction - Significance' },
                { id: 'body-part1', name: 'Body - Current Solutions' },
                { id: 'body-part2', name: 'Body - Career Impact' },
                { id: 'body-part3', name: 'Body - Critical Reflection' },
                { id: 'conclusion', name: 'Conclusion' }
            ];
            
            let allIssues = [];
            let totalWords = 0;
            let errorCount = 0;
            
            for (const section of sections) {
                const text = document.getElementById(section.id).value.trim();
                if (text) {
                    const issues = performGrammarCheck(text, section.name);
                    allIssues = allIssues.concat(issues);
                    totalWords += text.split(/\s+/).length;
                    errorCount += issues.filter(i => i.severity === 'error').length;
                    
                    // Try LanguageTool API as backup
                    try {
                        const apiIssues = await checkWithLanguageTool(text, section.name);
                        allIssues = allIssues.concat(apiIssues);
                    } catch (error) {
                        console.log('LanguageTool API unavailable, using local checks only');
                    }
                }
            }
            
            // Calculate grammar score
            const grammarScore = totalWords > 0 ? Math.max(0, 100 - (errorCount * 10)) : 0;
            document.getElementById('grammar-score').textContent = `${grammarScore}/100`;
            
            button.textContent = originalText;
            button.classList.remove('loading');
            button.disabled = false;
            
            displayGrammarResults(allIssues, 'Comprehensive Check');
        }
        
        async function checkWithLanguageTool(text, sectionName) {
            const issues = [];
            try {
                const response = await fetch('https://api.languagetool.org/v2/check', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: new URLSearchParams({
                        text: text,
                        language: 'en-US'
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    data.matches.forEach(match => {
                        const suggestion = match.replacements.length > 0 
                            ? match.replacements[0].value
                            : 'No suggestion available';
                        
                        issues.push({
                            type: 'api-check',
                            message: `${sectionName}: ${match.message} ‚Üí Suggested: "${suggestion}"`,
                            severity: match.rule.category.id === 'TYPOS' ? 'error' : 'warning'
                        });
                    });
                }
            } catch (error) {
                // Fail silently - local checks will still work
            }
            return issues;
        }
        
        function displayGrammarResults(issues, checkType) {
            const resultsDiv = document.getElementById('grammar-results');
            
            if (issues.length === 0) {
                resultsDiv.innerHTML = `
                    <div class="grammar-issue success">
                        <strong>‚úÖ Great work!</strong><br>
                        ${checkType}: No issues found. Your writing looks good!
                    </div>
                `;
                resultsDiv.className = 'grammar-results success';
            } else {
                const errorCount = issues.filter(i => i.severity === 'error').length;
                const warningCount = issues.filter(i => i.severity === 'warning').length;
                const suggestionCount = issues.filter(i => i.severity === 'suggestion').length;
                
                let html = `
                    <h3>üìã ${checkType} Results</h3>
                    <p><strong>Found:</strong> ${errorCount} errors, ${warningCount} warnings, ${suggestionCount} suggestions</p>
                `;
                
                issues.forEach(issue => {
                    const icon = issue.severity === 'error' ? '‚ùå' : 
                                issue.severity === 'warning' ? '‚ö†Ô∏è' : 'üí°';
                    html += `
                        <div class="grammar-issue ${issue.severity}">
                            ${icon} <strong>${issue.type.toUpperCase()}:</strong> ${issue.message}
                        </div>
                    `;
                });
                
                resultsDiv.innerHTML = html;
                resultsDiv.className = 'grammar-results';
            }
            
            resultsDiv.style.display = 'block';
            resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        function generateEssay() {
            const sections = [
                { id: 'intro-part1', label: '' },
                { id: 'intro-part2', label: '' },
                { id: 'intro-part3', label: '' },
                { id: 'intro-part4', label: '' }
            ];
            
            const bodySection = [
                { id: 'body-part1', label: '' },
                { id: 'body-part2', label: '' },
                { id: 'body-part3', label: '' }
            ];
            
            const conclusion = document.getElementById('conclusion').value.trim();
            
            // Combine introduction parts
            const intro = sections
                .map(s => document.getElementById(s.id).value.trim())
                .filter(text => text)
                .join(' ');
            
            // Combine body parts
            const body = bodySection
                .map(s => document.getElementById(s.id).value.trim())
                .filter(text => text)
                .join('\n\n');
            
            // Generate full essay
            let fullEssay = '';
            
            if (intro) {
                fullEssay += `INTRODUCTION\n\n${intro}\n\n`;
            } else {
                fullEssay += `INTRODUCTION\n\n[Please complete the introduction sections above]\n\n`;
            }
            
            if (body) {
                fullEssay += `MAIN BODY\n\n${body}\n\n`;
            } else {
                fullEssay += `MAIN BODY\n\n[Please complete the body sections above]\n\n`;
            }
            
            if (conclusion) {
                fullEssay += `CONCLUSION\n\n${conclusion}`;
            } else {
                fullEssay += `CONCLUSION\n\n[Please complete the conclusion section above]`;
            }
            
            const previewDiv = document.getElementById('essay-preview');
            previewDiv.textContent = fullEssay;
            previewDiv.style.display = 'block';
            previewDiv.scrollIntoView({ behavior: 'smooth' });
            
            // Analyze the complete essay
            const totalText = intro + ' ' + body + ' ' + conclusion;
            if (totalText.trim()) {
                const readability = analyzeReadability(totalText);
                setTimeout(() => {
                    alert(`üìä Essay Analysis:
‚Ä¢ Total words: ${totalText.split(/\s+/).length}
‚Ä¢ Average words per sentence: ${Math.round(readability.avgWordsPerSentence)}
‚Ä¢ Readability: ${readability.readabilityScore}
‚Ä¢ Complex sentences: ${readability.complexSentences}/${readability.totalSentences}
                    
${readability.readabilityScore === 'Complex' ? 'üí° Tip: Consider breaking up some longer sentences for better readability.' : '‚úÖ Good readability balance!'}`);
                }, 500);
            }
        }
        
        function exportEssay() {
            const essayText = document.getElementById('essay-preview').textContent;
            if (!essayText || essayText.includes('[Please complete')) {
                alert('Please generate your full essay first!');
                return;
            }
            
            // Create downloadable file
            const blob = new Blob([essayText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'my-career-sdg-essay.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // Advanced writing suggestions
        function getWritingTips() {
            return [
                "Use the STAR method: Situation, Task, Action, Result when giving examples",
                "Connect personal experiences to larger societal issues",
                "Use transition words: Furthermore, Additionally, However, Consequently",
                "Vary your sentence structure: mix short and long sentences",
                "Be specific: instead of 'many people', say '70% of young adults'",
                "Use active voice: 'I will create programs' not 'Programs will be created'",
                "End paragraphs with strong, forward-looking statements",
                "Use parallel structure: 'I aim to educate, innovate, and inspire'"
            ];
        }
        
        // Auto-save functionality
        function autoSave() {
            const sections = [
                'intro-part1', 'intro-part2', 'intro-part3', 'intro-part4',
                'body-part1', 'body-part2', 'body-part3', 'conclusion'
            ];
            
            const data = {};
            sections.forEach(id => {
                data[id] = document.getElementById(id).value;
            });
            
            // Note: localStorage not available in Claude artifacts, but this would work in real deployment
            console.log('Auto-saved essay data:', data);
        }
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Initial counter update
            updateCounters();
            
            // Set up auto-save (every 30 seconds)
            setInterval(autoSave, 30000);
            
            // Add helpful tooltips
            const tips = getWritingTips();
            let tipIndex = 0;
            
            // Rotate tips every 10 seconds
            setInterval(() => {
                const randomTip = tips[tipIndex % tips.length];
                document.title = `üí° Tip: ${randomTip}`;
                tipIndex++;
            }, 10000);
            
            // Add keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case 's': // Save/Export
                            e.preventDefault();
                            exportEssay();
                            break;
                        case 'g': // Grammar check
                            e.preventDefault();
                            comprehensiveGrammarCheck();
                            break;
                        case 'Enter': // Generate essay
                            if (e.shiftKey) {
                                e.preventDefault();
                                generateEssay();
                            }
                            break;
                    }
                }
            });
        });
        
        // Word suggestion engine
        const synonymSuggestions = {
            'important': ['crucial', 'vital', 'essential', 'significant', 'critical'],
            'big': ['substantial', 'considerable', 'extensive', 'major', 'significant'],
            'good': ['beneficial', 'positive', 'effective', 'valuable', 'advantageous'],
            'bad': ['detrimental', 'negative', 'harmful', 'problematic', 'adverse'],
            'help': ['assist', 'support', 'aid', 'facilitate', 'contribute to'],
            'make': ['create', 'develop', 'establish', 'generate', 'produce'],
            'show': ['demonstrate', 'illustrate', 'reveal', 'indicate', 'display']
        };
        
        // Enhanced spell check (basic implementation)
        function basicSpellCheck(text) {
            const commonMisspellings = {
                'recieve': 'receive',
                'seperate': 'separate', 
                'definately': 'definitely',
                'occured': 'occurred',
                'begining': 'beginning',
                'acheive': 'achieve',
                'beleive': 'believe',
                'necesary': 'necessary'
            };
            
            const suggestions = [];
            Object.keys(commonMisspellings).forEach(wrong => {
                if (text.toLowerCase().includes(wrong)) {
                    suggestions.push(`Possible misspelling: "${wrong}" ‚Üí "${commonMisspellings[wrong]}"`);
                }
            });
            
            return suggestions;
        }
        
        console.log('üöÄ Enhanced Essay Tool Loaded Successfully!');
        console.log('üí° Keyboard Shortcuts:');
        console.log('   Ctrl+S: Export essay');
        console.log('   Ctrl+G: Grammar check');
        console.log('   Ctrl+Shift+Enter: Generate essay');
    </script>
</body>
</html>
